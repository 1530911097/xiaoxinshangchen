!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?module.exports=i():"function"==typeof define&&define.amd?define(i):(t="undefined"!=typeof globalThis?globalThis:t||self).Indicators=i()}(this,function(){"use strict";var l=function(){return(l=Object.assign||function(t){for(var i,o=1,e=arguments.length;o<e;o++)for(var r in i=arguments[o])Object.prototype.hasOwnProperty.call(i,r)&&(t[r]=i[r]);return t}).apply(this,arguments)};function r(t,i){if(!t)throw new Error("[BScroll] "+i)}var e="undefined"!=typeof window,o=e&&navigator.userAgent.toLowerCase();o&&/wechatdevtools/.test(o),o&&o.indexOf("android"),function(){if("string"!=typeof o)return;var t=/os (\d\d?_\d(_\d)?)/.exec(o);if(!t)return;var i=t[1].split("_").map(function(t){return parseInt(t,10)});13===i[0]&&i[1]}();function a(){return window.performance&&window.performance.now&&window.performance.timing?window.performance.now()+window.performance.timing.navigationStart:+new Date}function y(t,i,o){return t<i?i:o<t?o:t}var n=e&&document.createElement("div").style,i=function(){if(!e)return!1;for(var t=0,i=[{key:"standard",value:"transform"},{key:"webkit",value:"webkitTransform"},{key:"Moz",value:"MozTransform"},{key:"O",value:"OTransform"},{key:"ms",value:"msTransform"}];t<i.length;t++){var o=i[t];if(void 0!==n[o.value])return o.key}return!1}();function t(t){return!1===i?t:"standard"===i?"transitionEnd"===t?"transitionend":t:i+t.charAt(0).toUpperCase()+t.substr(1)}function s(t,i,o,e){t.addEventListener(i,o,{passive:!1,capture:!!e})}function h(t,i,o,e){t.removeEventListener(i,o,{capture:!!e})}i&&"standard"!==i&&i.toLowerCase();var c=t("transform"),p=(t("transition"),e&&t("perspective")in n,c),d=t("transitionTimingFunction"),u=t("transitionDuration");t("transitionDelay"),t("transformOrigin"),t("transitionEnd"),t("transitionProperty");var m=(f.prototype.destroy=function(){this.removeDOMEvents(),this.events=[]},f.prototype.addDOMEvents=function(){this.handleDOMEvents(s)},f.prototype.removeDOMEvents=function(){this.handleDOMEvents(h)},f.prototype.handleDOMEvents=function(i){var o=this,e=this.wrapper;this.events.forEach(function(t){i(e,t.name,o,!!t.capture)})},f.prototype.handleEvent=function(i){var o=i.type;this.events.some(function(t){return t.name===o&&(t.handler(i),!0)})},f);function f(t,i){this.wrapper=t,this.events=i,this.addDOMEvents()}function v(t){t.preventDefault(),t.stopPropagation()}var g=(S.prototype.handleDOM=function(){var t=this.options,i=t.relationElement,o=t.relationElementHandleElementIndex,e=void 0===o?0:o;this.wrapper=i,this.indicatorEl=this.wrapper.children[e]},S.prototype.handleHooks=function(){var i=this,t=this.scroll,o=t.hooks,e=t.scroller.translater.hooks,r=t.scroller.animater.hooks;this.registerHooks(o,o.eventTypes.refresh,this.refresh),this.registerHooks(e,e.eventTypes.translate,function(t){i.updatePosition(t)}),this.registerHooks(r,r.eventTypes.time,this.transitionTime),this.registerHooks(r,r.eventTypes.timeFunction,this.transitionTimingFunction)},S.prototype.transitionTime=function(t){void 0===t&&(t=0),this.indicatorEl.style[u]=t+"ms"},S.prototype.transitionTimingFunction=function(t){this.indicatorEl.style[d]=t},S.prototype.handleInteractive=function(){!1!==this.options.interactive&&this.registerEvents()},S.prototype.registerHooks=function(t,i,o){t.on(i,o,this),this.hooksFn.push([t,i,o])},S.prototype.registerEvents=function(){var t=this.scroll.options,i=t.disableMouse,o=t.disableTouch,e=[],r=[],n=[];i||(e.push({name:"mousedown",handler:this.start.bind(this)}),r.push({name:"mousemove",handler:this.move.bind(this)}),n.push({name:"mouseup",handler:this.end.bind(this)})),o||(e.push({name:"touchstart",handler:this.start.bind(this)}),r.push({name:"touchmove",handler:this.move.bind(this)}),n.push({name:"touchend",handler:this.end.bind(this)},{name:"touchcancel",handler:this.end.bind(this)})),this.startEventRegister=new m(this.indicatorEl,e),this.moveEventRegister=new m(window,r),this.endEventRegister=new m(window,n)},S.prototype.refresh=function(){var t,i,o,e=this.scroll,r=e.x,n=e.y,s=e.hasHorizontalScroll,a=e.hasVerticalScroll,h=e.maxScrollX,l=e.maxScrollY,c=(t=this.options.ratio,i={ratioX:0,ratioY:0},t&&("number"==typeof t?i.ratioX=i.ratioY=t:"object"==typeof t&&t&&(i.ratioX=t.x||0,i.ratioY=t.y||0)),i),p=c.ratioX,d=c.ratioY,u={width:(o=this.wrapper).clientWidth,height:o.clientHeight},m=u.width,f=u.height,v=function(t){if(t instanceof window.SVGElement){var i=t.getBoundingClientRect();return{top:i.top,left:i.left,width:i.width,height:i.height}}return{top:t.offsetTop,left:t.offsetLeft,width:t.offsetWidth,height:t.offsetHeight}}(this.indicatorEl),y=v.width,g=v.height;s&&(this.maxScrollX=m-y,this.translateXSign=0<this.maxScrollX?-1:1,this.minScrollX=0,this.ratioX=p||Math.abs(this.maxScrollX/h)),a&&(this.maxScrollY=f-g,this.translateYSign=0<this.maxScrollY?-1:1,this.minScrollY=0,this.ratioY=d||Math.abs(this.maxScrollY/l)),this.updatePosition({x:r,y:n})},S.prototype.start=function(t){var i;this.BScrollIsDisabled()||(i=t.touches?t.touches[0]:t,v(t),this.initiated=!0,this.moved=!1,this.lastPointX=i.pageX,this.lastPointY=i.pageY,this.startTime=a(),this.scroll.scroller.hooks.trigger(this.scroll.scroller.hooks.eventTypes.beforeScrollStart))},S.prototype.BScrollIsDisabled=function(){return!this.scroll.enabled},S.prototype.move=function(t){var i,o,e,r,n,s;this.initiated&&(o=(i=t.touches?t.touches[0]:t).pageX,e=i.pageY,v(t),r=o-this.lastPointX,n=e-this.lastPointY,this.lastPointX=o,this.lastPointY=e,this.moved||this.indicatorNotMoved(r,n)||(this.moved=!0,this.scroll.scroller.hooks.trigger(this.scroll.scroller.hooks.eventTypes.scrollStart)),this.moved&&(s=this.getBScrollPosByRatio(this.currentPos,r,n),this.syncBScroll(s)))},S.prototype.end=function(t){var i,o,e;this.initiated&&(this.initiated=!1,v(t),this.moved&&(o=(i=this.scroll).x,e=i.y,this.scroll.scroller.hooks.trigger(this.scroll.scroller.hooks.eventTypes.scrollEnd,{x:o,y:e})))},S.prototype.getBScrollPosByRatio=function(t,i,o){var e,r,n=t.x,s=t.y,a=this.scroll,h=a.hasHorizontalScroll,l=a.hasVerticalScroll,c=a.minScrollX,p=a.maxScrollX,d=a.minScrollY,u=a.maxScrollY,m=this.scroll,f=m.x,v=m.y;return h&&(e=y(n+i,Math.min(this.minScrollX,this.maxScrollX),Math.max(this.minScrollX,this.maxScrollX)),f=y(Math.round(e/this.ratioX*this.translateXSign),p,c)),l&&(r=y(s+o,Math.min(this.minScrollY,this.maxScrollY),Math.max(this.minScrollY,this.maxScrollY)),v=y(Math.round(r/this.ratioY*this.translateYSign),u,d)),{x:f,y:v}},S.prototype.indicatorNotMoved=function(t,i){var o=this.currentPos,e=o.x,r=o.y,n=e===this.minScrollX&&t<=0||e===this.maxScrollX&&0<=t,s=r===this.minScrollY&&i<=0||r===this.maxScrollY&&0<=i;return n&&s},S.prototype.syncBScroll=function(t){var i=a(),o=this.scroll,e=o.options,r=o.scroller,n=e.probeType,s=e.momentumLimitTime;r.translater.translate(t),i-this.startTime>s&&(this.startTime=i,1===n&&r.hooks.trigger(r.hooks.eventTypes.scroll,t)),1<n&&r.hooks.trigger(r.hooks.eventTypes.scroll,t)},S.prototype.updatePosition=function(t){var i=this.getIndicatorPosByRatio(t);this.applyTransformProperty(i),this.currentPos=l({},i)},S.prototype.applyTransformProperty=function(t){var i=this.scroll.options.translateZ,o=["translateX("+t.x+"px)","translateY("+t.y+"px)",""+i];this.indicatorEl.style[p]=o.join(" ")},S.prototype.getIndicatorPosByRatio=function(t){var i,o,e=t.x,r=t.y,n=this.scroll,s=n.hasHorizontalScroll,a=n.hasVerticalScroll,h=l({},this.currentPos);return s&&(i=Math.round(this.ratioX*e*this.translateXSign),h.x=y(i,Math.min(this.minScrollX,this.maxScrollX),Math.max(this.minScrollX,this.maxScrollX))),a&&(o=Math.round(this.ratioY*r*this.translateYSign),h.y=y(o,Math.min(this.minScrollY,this.maxScrollY),Math.max(this.minScrollY,this.maxScrollY))),h},S.prototype.destroy=function(){!1!==this.options.interactive&&(this.startEventRegister.destroy(),this.moveEventRegister.destroy(),this.endEventRegister.destroy()),this.hooksFn.forEach(function(t){var i=t[0],o=t[1],e=t[2];i.off(o,e)}),this.hooksFn.length=0},S);function S(t,i){this.scroll=t,this.options=i,this.currentPos={x:0,y:0},this.hooksFn=[],this.handleDOM(),this.handleHooks(),this.handleInteractive()}function w(t){this.scroll=t,this.options=[],this.indicators=[],this.handleOptions(),this.handleHooks()}return w.prototype.handleOptions=function(){var t=this.scroll.options.indicators;r(Array.isArray(t),"'indicators' must be an array.");for(var i=0,o=t;i<o.length;i++){var e=o[i];r(!!e.relationElement,"'relationElement' must be a HTMLElement."),this.createIndicators(e)}},w.prototype.createIndicators=function(t){this.indicators.push(new g(this.scroll,t))},w.prototype.handleHooks=function(){var o=this,t=this.scroll.hooks;t.on(t.eventTypes.destroy,function(){for(var t=0,i=o.indicators;t<i.length;t++){i[t].destroy()}o.indicators=[]})},w.pluginName="indicators",w});
